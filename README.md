# marathon-elasticsearch 

This is a framework based upon the outstanding work of Chris Kite @ https://github.com/chriskite/elasticsearch-marathon. This framework features deployment of an Elasticsearch cluster on Marathon, using a bootstrap script approach for service discovery of all ES nodes within a cluster. All components of the framework are deployed as Docker containers that extend the hokiegeek2/ubuntu image.

Additional Features
-------------------
I've converted all service discovery logic to Python and added a few more elements:

1. Option for Bridge or Host networking for ES nodes
2. Extension of service discovery to enable clustering across Marathon applications and Marathon application groups
3. Load balancing and password-protected access to cluster with nginx
4. Cluster-level Kibana analysis via Kibana-nginx proxy interface
5. Specify mix of client-only, data-only, master-only, and data

# marathon-elasticsearch configuration

Environment
-----------
MARATHON_URL (Required)=http://marathon-host-ip-address-or-hostname:port

APP_NAME (Required)=comma-delimited list of Marathon Elasticsearch node task names

NETWORK_MODE=HOST or BRIDGE

MIN_NUM_MASTER_NODES=sets discovery.zen.minimum_master_nodes

CLUSTER_NAME=sets cluster.name

DATA_DIRECTORIES=sets path.data, which is a comma-delimited list of directories

ES_NODE_TYPE=CLIENT_NODE_ONLY (data.node=false, master.node=false), DATA_NODE_ONLY (data.node=true, master.node=false), or MASTER_NODE_ONLY (data.node=false). Defaults to master-eligible data node (data.node=true, master.node=true)

ES_GC_OPTS=overrides the default Java garbage collector algorithm. For example, a value of -XX:+UseG1GC switches to the G1 garbage collector algorithm.

Defaults
----------------------
path.data=/data

action.destructive_requires_name=true

cluster.name=Marathon-ES-Cluster

discovery.zen.minimum_master_nodes=1

node.data=true

master.node=true 

NETWORK_MODE=HOST

# marathon-es-cluster-nginx configuration

The marathon-es-cluster-nginx container can be run in either the Host or Bridge network configuration. Important note: for bridge networking, the containerPOrt and HostPort must match.

Environment
-----------
MARATHON_URL (Required)=http://marathon-host-ip-address-or-hostname:port

APP_NAME=comma-delimited list of Marathon Elasticsearch node task names

CONF_FILE=/etc/nginx/nginx.conf (default) this is where the conf file is generated by the bootstrap script

USERNAME=nginx username

PASSWORD=nginx password

# marathon-es-cluster-kibana configuration

Environment
-----------
MARATHON_URL (Required)=http://marathon-host-ip-address-or-hostname:port

NGINX_APP_NAME=comma-delimited list of Marathon nginx task names

USERNAME=username for nginx login

PASSWORD=password for nginx login
